CREATE OR REPLACE VIEW vw_user AS select `u`.`userId` AS `userId`,`u`.`userName` AS `userName`,`u`.`password` AS `password`,`u`.`description` AS `description`,`u`.`image` AS `image`,`u`.`status` AS `status`,`u`.`lastLogin` AS `lastLogin`,`u`.`userRole` AS `userRole`,`u`.`deletedDate` AS `deletedDate`,`u`.`deletedBy` AS `deletedBy`,`u`.`createdDate` AS `createdDate`,`u`.`createdBy` AS `createdBy`,`u`.`modifiedDate` AS `modifiedDate`,`u`.`modifiedBy` AS `modifiedBy`,group_concat(`r`.`name` separator ',') AS `rolename` from ((`tbl_user` `u` left join `tbl_user_role` `ur` on((`u`.`userId` = `ur`.`userId`))) left join `tbl_role` `r` on((`ur`.`roleId` = `r`.`roleId`))) group by `u`.`userId`,`u`.`userName`,`u`.`password`,`u`.`description`,`u`.`image`,`u`.`status`,`u`.`lastLogin`;

CREATE OR REPLACE VIEW vw_hr_attendance AS select `a`.`attendanceId` AS `attendanceId`,`a`.`staffId` AS `staffId`,`a`.`attendanceDate` AS `attendanceDate`,`a`.`inTime` AS `inTime`,`a`.`outTime` AS `outTime`,`a`.`deletedDate` AS `deletedDate`,`a`.`deletedBy` AS `deletedBy`,`a`.`createdDate` AS `createdDate`,`a`.`createdBy` AS `createdBy`,`a`.`modifiedDate` AS `modifiedDate`,`a`.`modifiedBy` AS `modifiedBy`,`s`.`staffCode` AS `staffCode`,`s`.`staffName` AS `staffName` from (tbl_hr_attendance `a` join `tbl_hr_staff` `s` on((`a`.`staffId` = `s`.`staffId`))) ;

CREATE OR REPLACE VIEW vw_hr_leave AS select `l`.`leaveId` AS `leaveId`,(case `l`.`status` when 'R' then 'Requested' when 'A' then 'Approved' when 'C' then 'Rejected' else 'Invalid' end) AS `status`,`l`.`staffId` AS `staffId`,(case `l`.`leaveType` when 'H' then 'Half-day' when 'F' then 'Full-day' when 'M' then 'Medical' when 'A' then 'Absent' else 'Invalid' end) AS `leaveType`,`l`.`date` AS `date`,`l`.`description` AS `description`,`l`.`deletedDate` AS `deletedDate`,`l`.`deletedBy` AS `deletedBy`,`l`.`createdDate` AS `createdDate`,`l`.`createdBy` AS `createdBy`,`l`.`modifiedDate` AS `modifiedDate`,`l`.`modifiedBy` AS `modifiedBy`,`s`.`staffCode` AS `staffCode`,`s`.`staffName` AS `staffName` from (`tbl_hr_leave` `l` join `tbl_hr_staff` `s` on((`l`.`staffId` = `s`.`staffId`)));

DROP INDEX name ON tbl_route;

DROP INDEX userName ON tbl_user;

CREATE OR REPLACE VIEW vw_account_closing AS select `close`.`closingId` AS `closingId`,`close`.`currencyId` AS `currencyId`,`close`.`receivableId` AS `receivableId`,`close`.`openingDate` AS `openingDate`,`close`.`openingAmount` AS `openingAmount`,`close`.`payableId` AS `payableId`,`close`.`closingDate` AS `closingDate`,`close`.`closingAmount` AS `closingAmount`,`close`.`deletedDate` AS `deletedDate`,`close`.`deletedBy` AS `deletedBy`,`close`.`createdDate` AS `createdDate`,`close`.`createdBy` AS `createdBy`,`close`.`modifiedDate` AS `modifiedDate`,`close`.`modifiedBy` AS `modifiedBy`,`cur`.`code` AS `currency`,`open`.`voucherNo` AS `receivable_voucher`,`pay`.`voucherNo` AS `payable_voucher` from (((`tbl_account_closing` `close` join `tbl_account_currency` `cur` on((`close`.`currencyId` = `cur`.`currencyId`))) left join `tbl_account_receivable` `open` on((`close`.`receivableId` = `open`.`receiveVoucherId`))) left join `tbl_account_payable` `pay` on((`close`.`payableId` = `pay`.`payVoucherId`)));

CREATE OR REPLACE VIEW vw_account_payable AS (select `pv`.`payVoucherId` AS `payVoucherId`,`pv`.`voucherNo` AS `voucherNo`,`pv`.`voucherDate` AS `voucherDate`,`pv`.`accountType` AS `accountType`,`pv`.`description` AS `description`,`pv`.`amount` AS `amount`,`pv`.`paymentType` AS `paymentType`,`pv`.`attachmentFile` AS `attachmentFile`,`pv`.`currencyId` AS `currencyId`,`pv`.`withdrawBy` AS `withdrawBy`,`pv`.`approveBy` AS `approveBy`,`pv`.`status` AS `status`,`pv`.`approvedDate` AS `approvedDate`,`pv`.`reason` AS `reason`,`pv`.`requestedDate` AS `requestedDate`,`pv`.`group_code` AS `group_code`,`pv`.`deletedDate` AS `deletedDate`,`pv`.`deletedBy` AS `deletedBy`,`pv`.`createdDate` AS `createdDate`,`pv`.`createdBy` AS `createdBy`,`pv`.`modifiedDate` AS `modifiedDate`,`pv`.`modifiedBy` AS `modifiedBy`,`ty`.`name` AS `type`,`cur`.`code` AS `currencyCode`,`cur`.`rate` AS `currencyRate`,`req`.`bankCode` AS `bankCode`,concat(`req`.`staffName`,'(',`req`.`staffCode`,')') AS `requester`,concat(`app`.`staffName`,'(',`app`.`staffCode`,')') AS `approver` from ((((`tbl_account_payable` `pv` left join `tbl_account_type` `ty` on((`pv`.`accountType` = `ty`.`accountTypeId`))) left join `tbl_account_currency` `cur` on((`pv`.`currencyId` = `cur`.`currencyId`))) left join `tbl_hr_staff` `req` on((`pv`.`withdrawBy` = `req`.`staffId`))) left join `tbl_hr_staff` `app` on((`pv`.`approveBy` = `app`.`staffId`))));

CREATE OR REPLACE VIEW vw_account_receivable AS (select `rv`.`receiveVoucherId` AS `receiveVoucherId`,`rv`.`voucherNo` AS `voucherNo`,`rv`.`voucherDate` AS `voucherDate`,`rv`.`accountType` AS `accountType`,`rv`.`description` AS `description`,`rv`.`amount` AS `amount`,`rv`.`paymentType` AS `paymentType`,`rv`.`attachmentFile` AS `attachmentFile`,`rv`.`currencyId` AS `currencyId`,`rv`.`depositBy` AS `depositBy`,`rv`.`approveBy` AS `approveBy`,`rv`.`status` AS `status`,`rv`.`approvedDate` AS `approvedDate`,`rv`.`reason` AS `reason`,`rv`.`requestedDate` AS `requestedDate`,`rv`.`group_code` AS `group_code`,`rv`.`deletedDate` AS `deletedDate`,`rv`.`deletedBy` AS `deletedBy`,`rv`.`createdDate` AS `createdDate`,`rv`.`createdBy` AS `createdBy`,`rv`.`modifiedDate` AS `modifiedDate`,`rv`.`modifiedBy` AS `modifiedBy`,`ty`.`name` AS `type`,`cur`.`code` AS `currencyCode`,`cur`.`rate` AS `currencyRate`,`req`.`bankCode` AS `bankCode`,concat(`req`.`staffName`,'(',`req`.`staffCode`,')') AS `requester`,concat(`app`.`staffName`,'(',`app`.`staffCode`,')') AS `approver` from ((((`tbl_account_receivable` `rv` left join `tbl_account_type` `ty` on((`rv`.`accountType` = `ty`.`accountTypeId`))) left join `tbl_account_currency` `cur` on((`rv`.`currencyId` = `cur`.`currencyId`))) left join `tbl_hr_staff` `req` on((`rv`.`depositBy` = `req`.`staffId`))) left join `tbl_hr_staff` `app` on((`rv`.`approveBy` = `app`.`staffId`))));

CREATE OR REPLACE VIEW vw_account_voucher AS select 'Receivable' AS `type`,`vw_account_receivable`.`receiveVoucherId` AS `voucherId`,`vw_account_receivable`.`voucherNo` AS `voucherNo`,`vw_account_receivable`.`voucherDate` AS `voucherDate`,`vw_account_receivable`.`accountType` AS `accountTypeId`,`vw_account_receivable`.`type` AS `accountType`,`vw_account_receivable`.`description` AS `description`,`vw_account_receivable`.`amount` AS `amount`,`vw_account_receivable`.`currencyId` AS `currencyId`,`vw_account_receivable`.`currencyCode` AS `currency`,`vw_account_receivable`.`currencyRate` AS `rate`,`vw_account_receivable`.`paymentType` AS `paymentType`,`vw_account_receivable`.`bankCode` AS `bankCode`,`vw_account_receivable`.`attachmentFile` AS `attachmentFile`,`vw_account_receivable`.`depositBy` AS `requestBy`,`vw_account_receivable`.`requester` AS `requester`,`vw_account_receivable`.`approveBy` AS `approveBy`,`vw_account_receivable`.`approver` AS `approver`,`vw_account_receivable`.`status` AS `status`,`vw_account_receivable`.`approvedDate` AS `approvedDate`,`vw_account_receivable`.`reason` AS `reason`,`vw_account_receivable`.`requestedDate` AS `requestedDate`,`vw_account_receivable`.`group_code` AS `group_code`,`vw_account_receivable`.`deletedDate` AS `deletedDate`,`vw_account_receivable`.`deletedBy` AS `deletedBy`,`vw_account_receivable`.`createdDate` AS `createdDate`,`vw_account_receivable`.`createdBy` AS `createdBy`,`vw_account_receivable`.`modifiedDate` AS `modifiedDate`,`vw_account_receivable`.`modifiedBy` AS `modifiedBy` from `vw_account_receivable` union all select 'Payable' AS `type`,`vw_account_payable`.`payVoucherId` AS `voucherId`,`vw_account_payable`.`voucherNo` AS `voucherNo`,`vw_account_payable`.`voucherDate` AS `voucherDate`,`vw_account_payable`.`accountType` AS `accountTypeId`,`vw_account_payable`.`type` AS `accountType`,`vw_account_payable`.`description` AS `description`,`vw_account_payable`.`amount` AS `amount`,`vw_account_payable`.`currencyId` AS `currencyId`,`vw_account_payable`.`currencyCode` AS `currency`,`vw_account_payable`.`currencyRate` AS `rate`,`vw_account_payable`.`paymentType` AS `paymentType`,`vw_account_payable`.`bankCode` AS `bankCode`,`vw_account_payable`.`attachmentFile` AS `attachmentFile`,`vw_account_payable`.`withdrawBy` AS `requestBy`,`vw_account_payable`.`requester` AS `requester`,`vw_account_payable`.`approveBy` AS `approveBy`,`vw_account_payable`.`approver` AS `approver`,`vw_account_payable`.`status` AS `status`,`vw_account_payable`.`approvedDate` AS `approvedDate`,`vw_account_payable`.`reason` AS `reason`,`vw_account_payable`.`requestedDate` AS `requestedDate`,`vw_account_payable`.`group_code` AS `group_code`,`vw_account_payable`.`deletedDate` AS `deletedDate`,`vw_account_payable`.`deletedBy` AS `deletedBy`,`vw_account_payable`.`createdDate` AS `createdDate`,`vw_account_payable`.`createdBy` AS `createdBy`,`vw_account_payable`.`modifiedDate` AS `modifiedDate`,`vw_account_payable`.`modifiedBy` AS `modifiedBy` from `vw_account_payable`;

CREATE OR REPLACE VIEW vw_cr_contact AS select `c`.`contactId` AS `contactId`,`c`.`name` AS `name`,`c`.`phone` AS `phone`,`c`.`email` AS `email`,`c`.`address` AS `address`,`c`.`website` AS `website`,`c`.`companyId` AS `companyId`,`c`.`notes` AS `notes`,`c`.`tag` AS `tag`,`c`.`status` AS `status`,`c`.`deletedDate` AS `deletedDate`,`c`.`deletedBy` AS `deletedBy`,`c`.`createdDate` AS `createdDate`,`c`.`createdBy` AS `createdBy`,`c`.`modifiedDate` AS `modifiedDate`,`c`.`modifiedBy` AS `modifiedBy`,`com`.`name` AS `companyname` from (`tbl_cr_contact` `c` left join `tbl_cr_company` `com` on((`c`.`companyId` = `com`.`companyId`)));

CREATE OR REPLACE VIEW vw_cr_contract AS (select `c`.`contractId` AS `contractId`,`c`.`companyId` AS `companyId`,`c`.`contactId` AS `contactId`,`c`.`projectId` AS `projectId`,`c`.`code` AS `code`,`c`.`name` AS `name`,`c`.`amount` AS `amount`,`c`.`currencyId` AS `currencyId`,`c`.`contractFile` AS `contractFile`,`c`.`contractBy` AS `contractBy`,`c`.`contractDate` AS `contractDate`,`c`.`notes` AS `notes`,`c`.`status` AS `status`,`c`.`deletedDate` AS `deletedDate`,`c`.`deletedBy` AS `deletedBy`,`c`.`createdDate` AS `createdDate`,`c`.`createdBy` AS `createdBy`,`c`.`modifiedDate` AS `modifiedDate`,`c`.`modifiedBy` AS `modifiedBy`,`com`.`name` AS `companyName`,`co`.`name` AS `contactName`,`p`.`name` AS `ProjectName`,`cr`.`code` AS `currencyCode` from ((((`tbl_cr_contract` `c` join `tbl_account_currency` `cr` on((`c`.`currencyId` = `cr`.`currencyId`))) join `tbl_cr_company` `com` on((`c`.`companyId` = `com`.`companyId`))) join `tbl_cr_contact` `co` on((`c`.`contactId` = `co`.`contactId`))) join `tbl_pm_project` `p` on((`c`.`projectId` = `p`.`projectId`)))) ;
 
CREATE OR REPLACE VIEW vw_cr_payment AS (select `p`.`paymentId` AS `paymentId`,`p`.`contractId` AS `contractId`,`p`.`type` AS `type`,`p`.`amount` AS `amount`,`p`.`currencyId` AS `currencyId`,`p`.`paymentDate` AS `paymentDate`,`p`.`status` AS `status`,`p`.`staffId` AS `staffId`,`p`.`contactId` AS `contactId`,`p`.`remark` AS `remark`,`p`.`deletedDate` AS `deletedDate`,`p`.`deletedBy` AS `deletedBy`,`p`.`createdDate` AS `createdDate`,`p`.`createdBy` AS `createdBy`,`p`.`modifiedDate` AS `modifiedDate`,`p`.`modifiedBy` AS `modifiedBy`,`cr`.`code` AS `contractName`,`ac`.`code` AS `currencyCode` from (((`tbl_cr_payment` `p` join `tbl_cr_contact` `c` on((`c`.`contactId` = `p`.`contactId`))) join `tbl_cr_contract` `cr` on((`cr`.`contractId` = `p`.`contractId`))) join `tbl_account_currency` `ac` on((`ac`.`currencyId` = `p`.`currencyId`))));

CREATE OR REPLACE VIEW vw_cr_proposal AS select `tbl_cr_proposal`.`proposalId` AS `proposalId`,`tbl_cr_proposal`.`companyId` AS `companyId`,`tbl_cr_proposal`.`contactId` AS `contactId`,`tbl_cr_proposal`.`code` AS `code`,`tbl_cr_proposal`.`name` AS `name`,`tbl_cr_proposal`.`amount` AS `amount`,`tbl_cr_proposal`.`currencyId` AS `currencyId`,`tbl_cr_proposal`.`proposalDate` AS `proposalDate`,`tbl_cr_proposal`.`proposalFile` AS `proposalFile`,`tbl_cr_proposal`.`notes` AS `notes`,`tbl_cr_proposal`.`proposalBy` AS `proposalBy`,`tbl_cr_proposal`.`group_code` AS `group_code`,`tbl_cr_proposal`.`status` AS `status`,`tbl_cr_proposal`.`deletedDate` AS `deletedDate`,`tbl_cr_proposal`.`deletedBy` AS `deletedBy`,`tbl_cr_proposal`.`createdDate` AS `createdDate`,`tbl_cr_proposal`.`createdBy` AS `createdBy`,`tbl_cr_proposal`.`modifiedDate` AS `modifiedDate`,`tbl_cr_proposal`.`modifiedBy` AS `modifiedBy`,`tbl_account_currency`.`code` AS `currencyCode` from (`tbl_cr_proposal` join `tbl_account_currency` on((`tbl_cr_proposal`.`currencyId` = `tbl_account_currency`.`currencyId`)));

DROP VIEW vw_payment;

CREATE OR REPLACE VIEW vw_hr_payroll AS select `p`.`payrollId` AS `payrollId`,`p`.`staffId` AS `staffId`,`p`.`fromDate` AS `fromDate`,`p`.`toDate` AS `toDate`,`p`.`m_wd` AS `m_wd`,`p`.`s_wd` AS `s_wd`,`p`.`salary` AS `salary`,`p`.`currencyId` AS `currencyId`,`p`.`bankCode` AS `bankCode`,`p`.`leave` AS `leave`,`p`.`absent` AS `absent`,`p`.`formula` AS `formula`,`p`.`Late` AS `Late`,`p`.`netSalary` AS `netSalary`,`p`.`managerId` AS `managerId`,`p`.`status` AS `status`,`p`.`deletedDate` AS `deletedDate`,`p`.`deletedBy` AS `deletedBy`,`p`.`createdDate` AS `createdDate`,`p`.`createdBy` AS `createdBy`,`p`.`modifiedDate` AS `modifiedDate`,`p`.`modifiedBy` AS `modifiedBy`,`s`.`staffCode` AS `staffCode`,`s`.`staffName` AS `staffName`,`s`.`Currency` AS `Currency`,`s`.`Position` AS `Position`,`s`.`Department` AS `Department` from (`tbl_hr_payroll` `p` join `vw_hr_staff` `s` on((`p`.`staffId` = `s`.`staffId`)));

CREATE OR REPLACE VIEW vw_hr_position AS select `pos`.`positionId` AS `positionId`,`pos`.`name` AS `name`,`pos`.`currencyId` AS `currencyId`,`pos`.`min_salary` AS `min_salary`,`pos`.`max_salary` AS `max_salary`,`pos`.`status` AS `status`,`pos`.`deletedDate` AS `deletedDate`,`pos`.`deletedBy` AS `deletedBy`,`pos`.`createdDate` AS `createdDate`,`pos`.`createdBy` AS `createdBy`,`pos`.`modifiedDate` AS `modifiedDate`,`pos`.`modifiedBy` AS `modifiedBy`,`cur`.`code` AS `currency` from (`tbl_hr_position` `pos` join `tbl_account_currency` `cur` on((`pos`.`currencyId` = `cur`.`currencyId`)));

CREATE OR REPLACE VIEW vw_hr_staff AS select `s`.`staffId` AS `staffId`,`s`.`userId` AS `userId`,`s`.`staffCode` AS `staffCode`,`s`.`staffName` AS `staffName`,`s`.`birthday` AS `birthday`,`s`.`positionId` AS `positionId`,`s`.`departmentId` AS `departmentId`,`s`.`workHours` AS `workHours`,`s`.`salary` AS `salary`,`s`.`currencyId` AS `currencyId`,`s`.`annual_leave` AS `annual_leave`,`s`.`permanentDate` AS `permanentDate`,`s`.`bankCode` AS `bankCode`,`s`.`status` AS `status`,`s`.`deletedDate` AS `deletedDate`,`s`.`deletedBy` AS `deletedBy`,`s`.`createdDate` AS `createdDate`,`s`.`createdBy` AS `createdBy`,`s`.`modifiedDate` AS `modifiedDate`,`s`.`modifiedBy` AS `modifiedBy`,`c`.`code` AS `Currency`,`u`.`userName` AS `UserName`,`p`.`name` AS `Position`,`d`.`name` AS `Department` from ((((`tbl_hr_staff` `s` left join `tbl_user` `u` on((`s`.`userId` = `u`.`userId`))) left join `tbl_hr_position` `p` on((`p`.`positionId` = `s`.`positionId`))) left join `tbl_hr_department` `d` on((`s`.`departmentId` = `d`.`departmentId`))) left join `tbl_account_currency` `c` on((`s`.`currencyId` = `c`.`currencyId`)));

CREATE OR REPLACE VIEW vw_pm_project AS select `pm`.`projectId` AS `projectId`,`pm`.`code` AS `code`,`pm`.`name` AS `name`,`pm`.`description` AS `description`,`pm`.`repository` AS `repository`,`pm`.`managerId` AS `managerId`,`pm`.`startDate` AS `startDate`,`pm`.`endDate` AS `endDate`,`pm`.`group_code` AS `group_code`,`pm`.`status` AS `status`,`pm`.`remark` AS `remark`,`pm`.`deletedDate` AS `deletedDate`,`pm`.`deletedBy` AS `deletedBy`,`pm`.`createdDate` AS `createdDate`,`pm`.`createdBy` AS `createdBy`,`pm`.`modifiedDate` AS `modifiedDate`,`pm`.`modifiedBy` AS `modifiedBy`,concat(`staff`.`staffName`,' (',`staff`.`staffCode`,')') AS `userName` from (`tbl_pm_project` `pm` left join `tbl_hr_staff` `staff` on((`pm`.`managerId` = `staff`.`staffId`)));

CREATE OR REPLACE VIEW vw_pm_task AS select `t`.`taskId` AS `taskId`,`t`.`name` AS `name`,`t`.`current` AS `current`,`t`.`staffId` AS `staffId`,`t`.`fromTime` AS `fromTime`,`t`.`toTime` AS `toTime`,`t`.`projectId` AS `projectId`,`t`.`predecessorId` AS `predecessorId`,(`t`.`level` + 1) AS `level`,`t`.`maxBudget` AS `maxBudget`,`t`.`currencyId` AS `currencyId`,`t`.`priority` AS `priority`,`t`.`description` AS `description`,`t`.`tag` AS `tag`,`t`.`managerId` AS `managerId`,`t`.`finished` AS `finished`,`t`.`status` AS `status`,`t`.`deletedDate` AS `deletedDate`,`t`.`deletedBy` AS `deletedBy`,`t`.`createdDate` AS `createdDate`,`t`.`createdBy` AS `createdBy`,`t`.`modifiedDate` AS `modifiedDate`,`t`.`modifiedBy` AS `modifiedBy`,`s`.`staffCode` AS `staffCode`,`s`.`staffName` AS `staffName`,`m`.`staffCode` AS `managerCode`,`m`.`staffName` AS `managerName`,`p`.`code` AS `projectCode`,`p`.`name` AS `projectName`,`c`.`code` AS `currencyCode`,`c`.`name` AS `currency` from ((((`tbl_pm_task` `t` join `tbl_hr_staff` `s` on((`t`.`staffId` = `s`.`staffId`))) join `tbl_hr_staff` `m` on((`t`.`managerId` = `m`.`staffId`))) left join `tbl_pm_project` `p` on((`t`.`projectId` = `p`.`projectId`))) left join `tbl_account_currency` `c` on((`t`.`currencyId` = `c`.`currencyId`)));
 
 

 